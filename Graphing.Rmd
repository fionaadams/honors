---
title: "Graphing"
author: "Fiona Adams"
date: "2/14/2020"
output: html_document
---

```{r}
new <- read.csv("mapped_data.csv")
transcripts <- readtext("All_Transcripts/*.docx")
```

Make quantile graph
```{r}
transcripts <- transcripts %>% mutate(nchar = nchar(text))

#yay!!!!
for(i in 1:nrow(transcripts)){
  nchars = transcripts$nchar[i]
  transcripts$quantile1[i] <- quantile(1:nchars)[2]
  transcripts$quantile2[i] <- quantile(1:nchars)[3]
  transcripts$quantile3[i] <- quantile(1:nchars)[4]
}

#write function that determined id, connects id to a nchar
#then, for each sentence within that id, give it a relative quantile value
#case_when
```

Left join transcripts to new, and then make a column that determines whether a sentence is between two quantiles or not.

```{r}
library(tidyr)
vars <- c("sentence_id", paste0("cluster_", 1:20))
#work on this! make long for better EDA stuffs
long_new <- pivot_longer(new, cols = starts_with("cluster"), names_to="cluster")

median <- median(long_new$sentence_id)

# 0 --> 164: First section
# 164 --> 328: Second section
# 328 --> 656: Third section
# 656 --> 984: Fourth section
# 984 --> 1297: Fifth section
long_new <- long_new %>%
  filter(!is.na(value)) %>%
  select(id, sentence_id, doc_id, description, family_experience, treatment_prof, personal_experience, value) %>%
  mutate(quadrant = ifelse(sentence_id<=median/2, "Quadrant 1", ifelse(sentence_id <=median, "Quadrant 2", ifelse(sentence_id <= median*2, "Quadrant 3", ifelse(sentence_id <= median*3, "Quadrant 4", "Quadrant 5"))))) #case_when would be better here! create 4 new var: quad 1, quad 2, etc.
```

```{r}
#Made deciles but they're not dependent on the length of an individual interview
library(ggplot2)
long_new %>% 
  filter(id==3) %>%
  ggplot(aes(x=quadrant, y=value)) + geom_jitter()
```
